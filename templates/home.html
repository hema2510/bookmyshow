{% extends "users/basic.html" %}
{% block content %}
<style>
:root {
    --primary: #e50914;
    --primary-dark: #b8070f;
    --secondary: #f5f5f1;
    --dark: #141414;
    --dark-light: #1f1f1f;
}
body {
    background: linear-gradient(135deg, var(--dark) 0%, #000 100%);
    color: var(--secondary);
    font-family: 'Roboto', sans-serif;
    line-height: 1.6;
}
.main-content {
    padding-top: 90px;
    padding-bottom: 40px;
}
/* Animated Particle Background */
.particles-bg {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: -1; pointer-events: none; overflow: hidden;
}
.particles-bg .particle {
    position: absolute;
    width: 4px; height: 4px; border-radius: 50%;
    background: var(--primary);
    opacity: .6;
    animation: floatUp 7s linear infinite;
}
@keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: .5;}
    30% { opacity: 1; }
    100% { transform: translateY(-100vh) scale(1.3); opacity: 0; }
}
/* Hero Section */
.hero-section {
    display: flex; flex-direction: column; align-items: center; text-align: center;
    min-height: 60vh; justify-content: center; margin-bottom: 2.5rem;
}
.hero-title {
    font-size: 3.3rem; font-weight: 900;
    background: linear-gradient(135deg, var(--primary), #ff6b6b 80%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: 1.1rem; letter-spacing: 2px;
}
.hero-desc {
    color: #b3b3b3; font-size: 1.25rem; margin-bottom: 2.5rem;
}
.search-main {
    max-width: 500px; margin: 0 auto;
    background: rgba(255,255,255,0.04);
    border: 1.5px solid rgba(255,255,255,0.09);
    border-radius: 32px; padding: 0.5rem 1rem;
    box-shadow: 0 2px 20px #e5091422;
    position: relative;
}
.search-main input {
    border: none; outline: none; background: transparent; color: var(--secondary);
    font-size: 1.1rem; width: 85%; padding: 11px 0;
}
.search-main button {
    background: var(--primary);
    border: none; color: #fff; border-radius: 20px;
    font-weight: 600; padding: 8px 18px; margin-left: 10px;
    transition: background .15s;
}
.search-main button:hover { background: var(--primary-dark);}
.autocomplete-box {
    position: absolute; left: 0; right: 0; top: 108%;
    background: var(--dark-light); border-radius: 0 0 16px 16px;
    box-shadow: 0 10px 32px #0004; z-index: 10;
    display: none;
}
.autocomplete-item {
    color: #fff; padding: 11px 18px; cursor: pointer; border-bottom: 1px solid #333;
    transition: background .15s;
}
.autocomplete-item:last-child { border-bottom: none;}
.autocomplete-item:hover { background: #242424; }
/* Showcases */
.showcase-section {
    margin: 2.5rem 0;
}
.showcase-title {
    font-size: 2.1rem; font-weight: 800;
    background: linear-gradient(135deg, var(--primary), #ff6b6b 80%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: 1.3rem;
}
.card-deck {
    display: flex; flex-wrap: wrap; gap: 1.8rem;
}
.showcase-card {
    background: var(--dark-light);
    border-radius: 16px; box-shadow: 0 2px 13px #0003;
    overflow: hidden; flex: 1 1 280px; min-width: 240px; cursor: pointer;
    transition: box-shadow .2s, transform .14s;
    position: relative;
}
.showcase-card:hover {
    box-shadow: 0 8px 36px #e5091433;
    transform: translateY(-8px) scale(1.01);
}
.showcase-card img {
    width: 100%; height: 220px; object-fit: cover;
    display: block;
}
.showcase-info {
    padding: 1.1rem 1.1rem 1rem 1.1rem;
}
.showcase-name {
    color: #fff; font-weight: 700; font-size: 1.2rem; margin-bottom: 0.4rem;
}
.showcase-desc {
    color: #bbb; font-size: 0.98rem; margin-bottom: 0.7rem;
}
.showcase-rating {
    position: absolute; top: 16px; right: 16px;
    background: linear-gradient(135deg, #ffd700, #f59e0b 80%);
    color: #000; padding: 4px 13px; border-radius: 14px;
    font-weight: 700; font-size: 1rem; z-index: 3;
}
.showcase-action {
    background: var(--primary); color: #fff; border: none;
    border-radius: 18px; padding: 7px 20px;
    font-weight: 600; transition: background .17s;
}
.showcase-action:hover { background: var(--primary-dark);}
.fab {
    position: fixed; bottom: 30px; right: 30px;
    width: 58px; height: 58px; background: var(--primary);
    border: none; border-radius: 50%; color: #fff;
    font-size: 1.5rem; cursor: pointer;
    box-shadow: 0 8px 32px #e5091430;
    z-index: 999;
    display: none; align-items: center; justify-content: center;
    transition: background .16s;
}
.fab.show { display: flex; }
.fab:hover { background: var(--primary-dark);}
.toast {
    position: fixed; top: 22px; right: 22px;
    background: #1f1f1fef; color: #fff;
    border-radius: 12px; z-index: 9999;
    padding: 15px 28px;
    font-size: 1.05rem;
    box-shadow: 0 6px 26px #e5091444;
    opacity: 0; pointer-events: none;
    transition: opacity .28s;
}
.toast.show { opacity: 1; pointer-events: auto; }
.view-all-btn {
    display: inline-block;
    background: linear-gradient(90deg, #e50914, #ff6b6b);
    color: #fff;
    padding: 12px 24px;
    border-radius: 25px;
    text-decoration: none;
    font-weight: 700;
    margin-top: 1.5rem;
    transition: transform 0.2s, box-shadow 0.2s;
}
.view-all-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px #e5091440;
    color: #fff;
    text-decoration: none;
}
@media (max-width: 800px) {
    .card-deck { gap: 1rem; }
    .showcase-card img { height: 160px; }
}
@media (max-width: 600px) {
    .main-content { padding-top: 72px; }
    .hero-title { font-size: 2rem;}
    .showcase-title { font-size: 1.2rem;}
    .card-deck { flex-direction: column;}
}
</style>

<!-- Animated Particle Background -->
<div class="particles-bg" id="particles-bg"></div>

<main class="main-content">
    <!-- Hero Section -->
<section class="hero-section" style="min-height:60vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;">
    <h1 class="hero-title" style="font-size:2.8rem;font-weight:900;letter-spacing:1.5px;margin-bottom:1rem;background:linear-gradient(90deg,#e50914,#ff6b6b);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">
        Enjoy Every Show, Every Experience
    </h1>
    <div class="hero-desc" style="font-size:1.25rem;max-width:520px;margin:0 auto 2.1rem auto;color:#ddd;">
        Your one stop for <b>movies</b>, <b>concerts</b>, <b>sports</b> and <b>live events</b>—all in your city.
    </div>

    
    <form class="search-main" id="searchBox" style="margin-top:0;box-shadow:0 4px 30px #e5091433;background:rgba(255,255,255,0.03);border:1.5px solid #e5091440;max-width:420px;width:100%;border-radius:32px;">
        <div class="input-group" style="align-items:center;">
            <span class="input-group-text bg-transparent border-0 ps-2" style="font-size:1.3rem;color:var(--primary);background:none;">
                <i class="fas fa-search"></i>
            </span>
            <input 
                type="text" 
                id="mainSearchInput"
                class="form-control border-0 bg-transparent"
                placeholder="Search movie, concert, event, or venue..."
                autocomplete="off"
                style="color:var(--secondary);font-size:1.08rem;background:none;box-shadow:none;"
            >
            <button class="btn btn-danger px-4" type="submit" id="mainSearchBtn" style="background:linear-gradient(90deg,#e50914,#b8070f);font-weight:700;border-radius:24px 24px 24px 24px;box-shadow:0 2px 12px #e5091435;">
                Find Tickets
            </button>
        </div>
        <div class="autocomplete-box" id="mainAutocomplete"></div>
    </form>
    <div style="margin-top:1.35rem;">
        <span style="color:orange;font-size:1.17rem;margin-right:7px;"><i class="fas fa-fire"></i></span>
        <span style="color:#aaa;font-size:1.01rem;">Trending:</span>
        <span class="badge" style="background:#e50914;margin-left:10px;margin-right:7px;padding:6px 13px;font-weight:700;cursor:pointer;" onclick="searchMovie('Echoes')">Echoes</span>
        <span class="badge" style="background:#23a97a;margin-right:7px;padding:6px 13px;font-weight:700;cursor:pointer;" onclick="window.location.href='/concerts/'">Arijit Live</span>
        <span class="badge" style="background:#1976d2;margin-right:7px;padding:6px 13px;font-weight:700;cursor:pointer;" onclick="window.location.href='/events/'">IPL Finals</span>
        <span class="badge" style="background:#ffc107;color:#222;padding:6px 13px;font-weight:700;cursor:pointer;" onclick="window.location.href='/events/'">Theater Festival</span>
    </div>
</section>

    <!-- Showcase: Trending Movies -->
    <section class="showcase-section" id="trending">
        <div class="showcase-title">Trending Movies</div>
        <div class="card-deck" id="trendingMovies"></div>
        <div style="text-align: center;">
            <a href="/movies/" class="view-all-btn">
                <i class="fas fa-film"></i> View All Movies
            </a>
        </div>
    </section>

    <!-- Showcase: Top Concerts -->
    <section class="showcase-section" id="concerts">
        <div class="showcase-title">Upcoming Concerts</div>
        <div class="card-deck" id="concertList"></div>
        <div style="text-align: center;">
            <a href="/concerts/" class="view-all-btn">
                <i class="fas fa-music"></i> View All Concerts
            </a>
        </div>
    </section>

    <!-- Showcase: Live Events -->
    <section class="showcase-section" id="events">
        <div class="showcase-title">Live Events Near You</div>
        <div class="card-deck" id="eventList"></div>
        <div style="text-align: center;">
            <a href="/events/" class="view-all-btn">
                <i class="fas fa-calendar-alt"></i> View All Events
            </a>
        </div>
    </section>
</main>

<!-- Floating Action Button -->
<button class="fab" id="scrollToTop"><i class="fas fa-arrow-up"></i></button>
<!-- Toast Notification -->
<div class="toast" id="toast"><span id="toastText">Welcome!</span></div>

<script>
// Particle Background
(() => {
    const bg = document.getElementById('particles-bg');
    function createParticle() {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random()*100 + '%';
        p.style.top = (Math.random()*80+10) + '%';
        p.style.animationDelay = (Math.random()*5) + 's';
        p.style.animationDuration = (Math.random()*6+5) + 's';
        bg.appendChild(p);
    }
    for (let i=0; i<42; ++i) createParticle();
})();

// Synchronized Data - Same as movies page - Using reliable placeholder images
const MOVIES = [
    {id:1, name:'Echoes: A Sci-Fi Spectacle', genre:'Sci-Fi', desc:'A mind-bending journey through space and time.', rating:9.1, img:'https://picsum.photos/400/600?random=1&blur=1'},
    {id:2, name:'The Last Laugh', genre:'Comedy', desc:'A hilarious adventure with a twist.', rating:8.7, img:'https://picsum.photos/400/600?random=2'},
    {id:3, name:'Midnight Heist', genre:'Thriller', desc:'A daring robbery unfolds under the city lights.', rating:9.0, img:'https://picsum.photos/400/600?random=3&grayscale'},
    {id:4, name:'Legends Reborn', genre:'Action', desc:'Heroes rise again to defend the realm.', rating:8.9, img:'https://picsum.photos/400/600?random=4'},
    {id:5, name:'Stardust Dreams', genre:'Romance', desc:'Love stories written in the stars.', rating:8.8, img:'https://picsum.photos/400/600?random=5&blur=1'},
    {id:6, name:'Into the Night', genre:'Drama', desc:'A mystery unravels as darkness falls.', rating:8.6, img:'https://picsum.photos/400/600?random=6'}
];
const CONCERTS = [
    {id:1, name:'Live at the Arena', desc:'A mega concert by top international artists.', img:'https://picsum.photos/600/400?random=10'},
    {id:2, name:'Symphony Night', desc:'Experience the magic of orchestral music.', img:'https://picsum.photos/600/400?random=11'},
    {id:3, name:'Jazz & Blues Fest', desc:'Groove to the smoothest jazz and blues.', img:'https://picsum.photos/600/400?random=12'}
];
const EVENTS = [
    {id:1, name:'City Food Carnival', desc:'Taste the best street foods & cuisines.', img:'https://picsum.photos/600/400?random=13'},
    {id:2, name:'Theater: Hamlet', desc:'A modern adaptation of Shakespeare\'s classic.', img:'https://picsum.photos/600/400?random=14'},
    {id:3, name:'Standup Comedy Night', desc:'Laugh out loud with top comedians.', img:'https://picsum.photos/600/400?random=15'},
    {id:4, name:'Marathon 2025', desc:'Join the largest running event in the city!', img:'https://picsum.photos/600/400?random=16'}
];

// Combined search terms
const SEARCH_TERMS = [
    ...MOVIES.map(m=>m.name),
    ...CONCERTS.map(c=>c.name),
    ...EVENTS.map(e=>e.name)
];

// Display Card Decks with image error handling
function renderShowcase(list, target, isMovie=false) {
    document.getElementById(target).innerHTML = list.map(item => `
        <div class="showcase-card" tabindex="0">
            <img src="${item.img}" alt="${item.name}" loading="lazy" onerror="this.onerror=null; this.src='https://via.placeholder.com/${isMovie ? '400x600' : '600x400'}/333/fff?text=${encodeURIComponent(item.name)}';">
            ${isMovie ? `<span class="showcase-rating"><i class="fas fa-star"></i> ${item.rating}</span>` : ''}
            <div class="showcase-info">
                <div class="showcase-name">${item.name}</div>
                <div class="showcase-desc">${item.desc}</div>
                <button class="showcase-action" onclick="bookAction('${item.name}','${isMovie?'movie':target.replace('List','')}')">
                    <i class="fas fa-ticket-alt"></i> Book Now
                </button>
            </div>
        </div>
    `).join('');
}

// Render all showcases
renderShowcase(MOVIES.slice(0, 6), 'trendingMovies', true); // Show first 6 movies
renderShowcase(CONCERTS, 'concertList');
renderShowcase(EVENTS, 'eventList');

// Enhanced booking action with proper navigation
window.bookAction = function(name, type) {
    if (type === 'movie') {
        // Navigate to movies page with specific movie
        window.location.href = `/movies/?movie=${encodeURIComponent(name)}`;
    } else if (type === 'concert') {
        // Navigate to concerts page (you can create this later)
        showToast(`🎵 Redirecting to concerts for "${name}"`);
        // window.location.href = `/concerts/?concert=${encodeURIComponent(name)}`;
        setTimeout(() => window.location.href = '/concerts/', 1000);
    } else if (type === 'event') {
        // Navigate to events page (you can create this later)
        showToast(`🎪 Redirecting to events for "${name}"`);
        // window.location.href = `/events/?event=${encodeURIComponent(name)}`;
        setTimeout(() => window.location.href = '/events/', 1000);
    }
};

// Search specific movie function
window.searchMovie = function(movieName) {
    window.location.href = `/movies/?movie=${encodeURIComponent(movieName)}`;
};

// Toast notification function
function showToast(msg) {
    const toast = document.getElementById('toast');
    document.getElementById('toastText').textContent = msg;
    toast.classList.add('show');
    clearTimeout(window._toastTimer);
    window._toastTimer = setTimeout(() => toast.classList.remove('show'), 3000);
}

// FAB scroll to top
const fab = document.getElementById('scrollToTop');
window.addEventListener('scroll', () => {
    if (window.scrollY > 250) fab.classList.add('show');
    else fab.classList.remove('show');
});
fab.addEventListener('click', () => window.scrollTo({top:0,behavior:'smooth'}));

// Enhanced Search/Autocomplete functionality
const searchInput = document.getElementById('mainSearchInput');
const searchBtn = document.getElementById('mainSearchBtn');
const autocomplete = document.getElementById('mainAutocomplete');
let searchFocusIdx = -1;

searchInput.addEventListener('input', function() {
    const v = this.value.trim().toLowerCase();
    if (v.length < 2) { 
        autocomplete.style.display='none'; 
        return; 
    }
    
    const filteredMovies = MOVIES.filter(movie => movie.name.toLowerCase().includes(v));
    const filteredConcerts = CONCERTS.filter(concert => concert.name.toLowerCase().includes(v));
    const filteredEvents = EVENTS.filter(event => event.name.toLowerCase().includes(v));
    
    const allFiltered = [
        ...filteredMovies.map(item => ({...item, type: 'movie'})),
        ...filteredConcerts.map(item => ({...item, type: 'concert'})),
        ...filteredEvents.map(item => ({...item, type: 'event'}))
    ].slice(0, 6);
    
    if (allFiltered.length === 0) { 
        autocomplete.style.display='none'; 
        return; 
    }
    
    autocomplete.innerHTML = allFiltered.map(item => {
        const typeIcon = item.type === 'movie' ? 'fa-film' : item.type === 'concert' ? 'fa-music' : 'fa-calendar';
        const typeColor = item.type === 'movie' ? '#e50914' : item.type === 'concert' ? '#1db954' : '#ff6b35';
        return `<div class="autocomplete-item" data-name="${item.name}" data-type="${item.type}">
            <i class="fas ${typeIcon}" style="color: ${typeColor}; margin-right: 8px;"></i>
            ${item.name}
            <small style="color: #888; margin-left: 8px;">(${item.type})</small>
        </div>`;
    }).join('');
    
    autocomplete.style.display = 'block';
    searchFocusIdx = -1;
});

autocomplete.addEventListener('mousedown', function(e){
    if (e.target.classList.contains('autocomplete-item') || e.target.closest('.autocomplete-item')) {
        const item = e.target.closest('.autocomplete-item');
        const name = item.dataset.name;
        const type = item.dataset.type;
        searchInput.value = name;
        autocomplete.style.display = 'none';
        navigateToItem(name, type);
    }
});

searchInput.addEventListener('keydown', function(e){
    const items = autocomplete.querySelectorAll('.autocomplete-item');
    if (!items.length) return;
    
    if (e.key === "ArrowDown") {
        e.preventDefault();
        searchFocusIdx = (searchFocusIdx+1)%items.length;
        updateAutocompleteSelection(items);
    }
    else if (e.key === "ArrowUp") {
        e.preventDefault();
        searchFocusIdx = (searchFocusIdx-1+items.length)%items.length;
        updateAutocompleteSelection(items);
    }
    else if (e.key === "Enter" && searchFocusIdx>=0) {
        e.preventDefault();
        const selectedItem = items[searchFocusIdx];
        const name = selectedItem.dataset.name;
        const type = selectedItem.dataset.type;
        searchInput.value = name;
        autocomplete.style.display = 'none';
        navigateToItem(name, type);
    }
});

function updateAutocompleteSelection(items) {
    items.forEach((item, i) => {
        item.style.background = i === searchFocusIdx ? '#242424' : '';
    });
}

function navigateToItem(name, type) {
    if (type === 'movie') {
        window.location.href = `/movies/?movie=${encodeURIComponent(name)}`;
    } else if (type === 'concert') {
        showToast(`🎵 Found concert: "${name}"`);
        setTimeout(() => window.location.href = '/concerts/', 1000);
    } else if (type === 'event') {
        showToast(`🎪 Found event: "${name}"`);
        setTimeout(() => window.location.href = '/events/', 1000);
    }
}

document.addEventListener('click', e=>{
    if (!e.target.closest('.search-main')) autocomplete.style.display='none';
});

searchBtn.addEventListener('click', (e)=>{
    e.preventDefault();
    doSearch();
});

function doSearch() {
    const q = searchInput.value.trim().toLowerCase();
    if (!q) return showToast('🔎 Please enter something to search!');
    
    // Search across all categories
    const foundMovie = MOVIES.find(m => m.name.toLowerCase().includes(q));
    const foundConcert = CONCERTS.find(c => c.name.toLowerCase().includes(q));
    const foundEvent = EVENTS.find(e => e.name.toLowerCase().includes(q));
    
    if (foundMovie) {
        navigateToItem(foundMovie.name, 'movie');
    } else if (foundConcert) {
        navigateToItem(foundConcert.name, 'concert');
    } else if (foundEvent) {
        navigateToItem(foundEvent.name, 'event');
    } else {
        showToast('❌ No results found. Try a different search term.');
    }
}

// Welcome message
window.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        showToast('🎬 Welcome! Discover amazing movies and events.');
    }, 1000);
});
</script>
{% endblock %}